.app-redesigned {
  position: relative;
  width: 100%;
  min-height: 100vh;
  height: 100dvh;
  overflow: hidden;
  color: var(--text-primary);
}

.liquid-filter-defs {
  position: absolute;
  width: 0;
  height: 0;
}

.map-container {
  position: fixed;
  top: var(--topbar-height);
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 1;
  background:
    radial-gradient(140% 120% at 12% 8%, rgba(248, 250, 252, 0.2), transparent 46%),
    linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
}

.map-container::before,
.map-container::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.map-container::before {
  background: radial-gradient(circle at 14% 9%, rgba(248, 250, 252, 0.22), transparent 40%);
  mix-blend-mode: screen;
  opacity: 0.5;
}

.map-container::after {
  background: linear-gradient(180deg, rgba(15, 23, 42, 0.08), rgba(15, 23, 42, 0.52));
}

.storm-fog,
.rain-streak-layer,
.raindrop-layer {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.storm-fog {
  z-index: 5;
  background: rgba(203, 213, 225, 0.2);
  backdrop-filter: blur(36px) saturate(90%);
  -webkit-backdrop-filter: blur(36px) saturate(90%);
}

.rain-streak-layer {
  z-index: 6;
  overflow: hidden;
}

.rain-streak {
  position: absolute;
  top: -24%;
  height: 45%;
  border-radius: 999px;
  background: linear-gradient(
    180deg,
    rgba(248, 250, 252, 0),
    rgba(248, 250, 252, 0.58) 25%,
    rgba(226, 232, 240, 0.14) 88%,
    rgba(248, 250, 252, 0)
  );
  filter: blur(0.2px);
  animation-name: streakFall;
  animation-timing-function: linear;
  animation-iteration-count: infinite;
  will-change: transform;
}

.raindrop-layer {
  z-index: 7;
}

.raindrop-static {
  position: absolute;
  border-radius: 50% 50% 44% 44%;
  background: rgba(248, 250, 252, 0.56);
  box-shadow: 0 0 10px rgba(248, 250, 252, 0.08);
  animation: floatDrop 8s ease-in-out infinite;
  will-change: transform;
}

.raindrop-static:nth-child(odd) {
  animation-delay: -2.2s;
}

.raindrop-static:nth-child(3n) {
  animation-delay: -4.3s;
}

.map-canvas {
  height: 100%;
  width: 100%;
}

.map-google-fallback {
  height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
  text-align: center;
  background: linear-gradient(160deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
  color: var(--text-muted);
}

.app-loading {
  display: grid;
  place-items: center;
  min-height: 100vh;
  background: linear-gradient(180deg, var(--bg-2), var(--bg-0));
}

.app-loading p {
  margin: 14px 0 0;
  color: var(--text-muted);
  font-family: "IBM Plex Mono", monospace;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  font-size: 0.72rem;
}

.spinner-large {
  width: 52px;
  height: 52px;
  border-radius: 50%;
  border: 3px solid rgba(248, 250, 252, 0.2);
  border-top-color: rgba(248, 250, 252, 0.86);
  animation: spin 1200ms linear infinite;
  box-shadow: 0 0 24px rgba(226, 232, 240, 0.2);
}

.pins-toggle {
  position: fixed;
  left: 18px;
  bottom: 20px;
  z-index: 950;
  display: inline-flex;
  align-items: center;
  gap: 7px;
  height: 40px;
  padding: 0 14px;
  border-radius: var(--radius-pill);
  border: 1px solid var(--stroke-strong);
  background: rgba(248, 250, 252, 0.08);
  backdrop-filter: blur(24px);
  color: var(--text-primary);
  font-size: 0.8rem;
  font-family: "IBM Plex Mono", monospace;
  letter-spacing: 0.06em;
  cursor: pointer;
  transition:
    background var(--motion-fast) var(--ease-standard),
    border-color var(--motion-fast) var(--ease-standard),
    color var(--motion-fast) var(--ease-standard),
    box-shadow var(--motion-fast) var(--ease-standard);
  box-shadow: var(--shadow-soft);
}

.pins-toggle:hover {
  background: rgba(248, 250, 252, 0.14);
  border-color: rgba(248, 250, 252, 0.62);
}

.pins-toggle.pins-off {
  color: var(--text-dim);
  border-color: var(--stroke);
  background: rgba(148, 163, 184, 0.09);
  box-shadow: none;
}

body.modal-open {
  overflow: hidden;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

@keyframes streakFall {
  from {
    transform: translateY(-36vh);
  }
  to {
    transform: translateY(128vh);
  }
}

@keyframes floatDrop {
  0% {
    transform: translateY(0) scaleY(1);
  }
  50% {
    transform: translateY(2px) scaleY(1.03);
  }
  100% {
    transform: translateY(0) scaleY(1);
  }
}

@media (min-width: 768px) {
  .pins-toggle {
    left: 24px;
    bottom: 24px;
  }
}

@media (max-width: 900px) {
  .storm-fog {
    backdrop-filter: blur(24px) saturate(88%);
    -webkit-backdrop-filter: blur(24px) saturate(88%);
    background: rgba(203, 213, 225, 0.17);
  }

  .rain-streak {
    height: 38%;
    opacity: 0.12 !important;
  }
}

@media (max-width: 680px) {
  .storm-fog {
    backdrop-filter: blur(16px) saturate(84%);
    -webkit-backdrop-filter: blur(16px) saturate(84%);
    background: rgba(203, 213, 225, 0.14);
  }

  .rain-streak-layer .rain-streak:nth-child(n + 17) {
    display: none;
  }

  .raindrop-layer .raindrop-static:nth-child(n + 25) {
    display: none;
  }

  .rain-streak {
    height: 34%;
  }

  .raindrop-static {
    box-shadow: none;
    animation-duration: 9.5s;
  }
}
